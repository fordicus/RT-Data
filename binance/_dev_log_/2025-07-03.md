# Functions by Category

## 🧱 1. **로깅 및 유틸리티**

| 함수명                           | 기능              |
| ----------------------------- | --------------- |
| ✅ `UTCFormatter.formatTime()` | UTC 로그 타임스탬프 변환 |
| ✅ `resource_path()`           | 실행 환경별 경로 해석    |
| ✅ `load_config()`             | 설정 파일 로드        |

---

## 🧠 2. **런타임 초기화 및 상태 관리**

| 함수명                                  | 기능            |
| ------------------------------------ | ------------- |
| ✅ `initialize_event_flags()`         | 이벤트 객체 초기화    |
| ✅ `assert_event_flags_initialized()` | 이벤트 초기화 여부 확인 |
| ✅ `initialize_runtime_state()`       | 상태 변수 및 큐 초기화 |

---

## 📁 3. **파일 처리**

| 함수명                                   | 기능          |
| ------------------------------------- | ----------- |
| 🔍 `get_file_suffix()`                | 파일명 접미어 생성  |
| 🔍 `get_date_from_suffix()`           | 접미어에서 날짜 추출 |
| 🔍 `zip_and_remove()`                 | 파일 압축 및 삭제  |
| 🔍 `merge_day_zips_to_single_jsonl()` | 분 단위 파일 병합  |
| 🔍 `merge_all_symbols_for_day()`      | 모든 심볼 병합 실행 |

---

## 📶 4. **지연 시간 측정 및 제어**

| 함수명                                   | 기능                |
| ------------------------------------- | ----------------- |
| ✅ `gate_streaming_by_latency()`       | latency 기반 스트림 제어 |
| ✅ `estimate_latency_via_diff_depth()` | latency 측정 및 검증   |

---

## 🔄 5. **스냅샷 수집 및 저장**

| 함수명                            | 기능                 |
| ------------------------------ | ------------------ |
| ✅ `put_snapshot()`             | 스냅샷 수집 및 메모리 저장    |
| 🔍`dump_snapshot_for_symbol()` | 스냅샷 파일 저장 및 병합 트리거 |

---

## 💡 6. **FastAPI 엔드포인트**

| 함수명                    | 경로                    | 기능           |
| ---------------------- | --------------------- | ------------ |
| 🤏🏼`health_live()`    | `/health/live`        | 생존 상태 확인     |
| 🤏🏼`health_ready()`   | `/health/ready`       | 준비 상태 확인     |
| 🤏🏼`get_order_book()` | `/state/{symbol}`     | 최신 스냅샷 반환    |
| 🤏🏼`orderbook_ui()`   | `/orderbook/{symbol}` | 오더북 HTML 시각화 |

---

## 🛑 7. **정리 및 종료 처리**

| 함수명                       | 기능          |
| ------------------------- | ----------- |
| 🤏🏼`graceful_shutdown()` | 파일 핸들 안전 종료 |
| 🤏🏼`main()`              | 시스템 실행 진입점  |

---
# Note

나는 지난 며칠간 `stream_binance.py`의 연구와 개발에 몰두해 왔다.
수많은 개선을 이뤄냈지만, 이제 이 이상 코드를 계속 고치는 것은 대부분 불필요하다고 생각한다.
왜냐하면 **완벽한 코드란 존재하지 않기 때문**이다.

원하는 기능은 이미 구현을 마쳤다.
이제는 **실제 테스트를 기반으로 개선점을 찾아나갈 단계**이지, 언제까지나 코드만 붙잡고 있을 수는 없다.

---

내일부터 최단 기간 내에 수행하고자 하는 작업은 다음과 같다:

---

**0.** 랩톱을 Swisscom 라우터의 가장 빠른 포트에 유선으로 연결한다.

---

**1.** WSL2 Ubuntu 환경에서 Chrony를 설치하여 로컬 머신의 부정확한 시계 문제를 해결한다.
현재 상태는 다음과 같다:

```
C:\workspace\RT-Data\binance>w32tm /query /status  
Leap Indicator: 0 (no warning)  
Stratum: 2 (secondary reference - synced by (S)NTP)  
Precision: -23 (119.209ns per tick)  
Root Delay: 0.0214600s  
Root Dispersion: 8.4569219s  
ReferenceId: 0xF2478FA9 (MD5 hash fraction of the IPv6 address)  
Last Successful Sync Time: 2025-07-02 오후 9:22:56  
Source: time.google.com  
Poll Interval: 10 (1024s)  
```

---

**2.** `stream_binance.py` 스크립트를 **정밀하게 프로파일링**한다.
Windows에서 테스트할 때는 `requirements.txt`의 패키지들이 설치된 Conda 가상환경에서 다음 명령어로 실행한다:

```
python stream_binance.py
```

파이썬 버전을 포함하여 이 가상환경과 동일한 환경을 VS Code에 설정한 뒤, 프로파일링을 진행한다.
**SYMBOLS의 선택은 실제 운영 환경과 유사한 부하가 발생하도록 신중히 결정**해야 한다.
특히, **StarTrader등에서 거래를 지원하는 SYMBOLS**를 노리자.

---

**3.** `stream_binance.py`의 **성능과 동작 상태**, 그리고 해당 스크립트가 실행 중인 **우분투 홈서버의 상태를 총괄적으로 모니터링할 수 있는 웹 서비스를 구축**한다.
이 웹 서비스는 DuckDNS를 통해 외부에서도 접근 가능하게 한다.
또한, Uptimerobot 등의 도구를 이용해 해당 웹 포트를 모니터링하면,
`stream_binance.py`와 홈서버의 상태를 실시간으로 파악할 수 있다.

---
