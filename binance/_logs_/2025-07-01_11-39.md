## âœ… \[1] `FileNotFoundError` in `merge_day_zips_to_single_jsonl()`

### ğŸ” ë¬¸ì œ ìš”ì•½

```
FileNotFoundError: [Errno 2] No such file or directory: './data/binance/orderbook/BTCUSDC_orderbook_2025-06-27.jsonl'
```

### ğŸ§  ê°€ëŠ¥í•œ ì›ì¸

ì´ ì˜¤ë¥˜ëŠ” ë‹¤ìŒ ë‘ ì¡°ê±´ ì¤‘ í•˜ë‚˜ë¼ë„ ë§Œì¡±ë  ë•Œ ë°œìƒí•©ë‹ˆë‹¤:

1. `merged_path` íŒŒì¼ì„ ìƒì„±í•œ ì§í›„ ì‚­ì œë˜ì—ˆê±°ë‚˜ ìƒì„± ìì²´ê°€ ì‹¤íŒ¨.
2. `tmp_dir`ì—ëŠ” `.zip` íŒŒì¼ì´ ìˆì—ˆìœ¼ë‚˜, ë‚´ë¶€ì— `.jsonl`ì„ í¬í•¨í•˜ì§€ ì•ŠìŒ â†’ `merged_path`ì— ì•„ë¬´ê²ƒë„ ì“°ì´ì§€ ì•ŠìŒ â†’ í›„ì²˜ë¦¬ì—ì„œ `os.remove(merged_path)` í˜¸ì¶œ ì‹œ í•´ë‹¹ íŒŒì¼ì´ ì—†ì–´ì„œ ì—ëŸ¬ ë°œìƒ.

### ğŸ’¡ ê°œì„  ë°©ì•ˆ

```python
# before removing merged_path, ensure it was written
if os.path.exists(merged_path):
	os.remove(merged_path)
```

ë˜ëŠ”, ë‹¤ìŒê³¼ ê°™ì´ **empty fileì¸ì§€ í™•ì¸**í•˜ëŠ” ë°©ì‹ë„ ê°€ëŠ¥:

```python
if os.path.exists(merged_path) and os.path.getsize(merged_path) > 0:
	os.remove(merged_path)
else:
	logger.warning(f"Nothing to merge for {symbol}@{day_str}")
```

---

## âœ… \[2] `WebSocket` ì˜¤ë¥˜ë“¤ (keepalive timeout, `gaierror`)

### ğŸ” ì¦ìƒ

* `sent 1011 (unexpected error) keepalive ping timeout`
* `socket.gaierror: [Errno -3] Temporary failure in name resolution`

### ğŸ§  ì›ì¸ í•´ì„

| ì˜¤ë¥˜ ìœ í˜•                  | ì˜ë¯¸                                           |
| ---------------------- | -------------------------------------------- |
| `1011` WebSocket close | Binance ì„œë²„ ì¸¡ ì¥ì•  ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì •                  |
| `gaierror -3`          | DNS name resolution ì‹¤íŒ¨ (ì„œë²„ê°€ ì¼ì‹œì ìœ¼ë¡œ ì¸í„°ë„· ë¶ˆê°€ ìƒíƒœ) |

### ğŸ’¡ ê°œì„  ë°©ì•ˆ

1. **ìë™ ì¬ì—°ê²° ë¡œì§ì€ ì´ë¯¸ êµ¬í˜„ë¨** (`exponential backoff` + `RESET_CYCLE_AFTER`)
2. ê·¸ëŸ¬ë‚˜ **DNS ì˜¤ë¥˜ëŠ” ì‹œìŠ¤í…œ ì¸¡ ë¡œê·¸ë¡œ ëª…í™•íˆ ë‚¨ê¸°ê¸°** ìœ„í•´ ë‹¤ìŒ ë¡œì§ ì¶”ê°€ ê¶Œì¥:

```python
except socket.gaierror as e:
	logger.error(f"DNS resolution failed: {e}. Check internet connectivity.")
```

ë˜í•œ, `websockets.connect()`ì— `ping_timeout` ê°’ì„ ëŠ˜ë¦¬ëŠ” ì˜µì…˜ë„ ê³ ë ¤:

```python
async with websockets.connect(WS_URL, ping_timeout=20) as ws:
```

---

## âœ… \[3] `LOGGING`: ë¡œê·¸ íŒŒì¼ ì €ì¥ + íƒ€ì„ìŠ¤íƒ¬í”„ ë¯¸ì¶œë ¥ ë¬¸ì œ

### ğŸ” í˜„ì¬ ìƒí™©

* `uvicorn.error` loggerë¥¼ ì“°ê³  ìˆì§€ë§Œ, **íŒŒì¼ ì €ì¥ ì„¤ì • ì—†ìŒ**
* ê¸°ë³¸ ë¡œê·¸ í¬ë§·ì— íƒ€ì„ìŠ¤íƒ¬í”„ ì—†ìŒ

### ğŸ’¡ ê°œì„  ë°©ì•ˆ

ì•„ë˜ë¥¼ `stream_binance.py` ìµœìƒë‹¨ ì–´ë”˜ê°€ (ì˜ˆ: `FastAPI()` ì„ ì–¸ ì „)ì— ì¶”ê°€í•´ ì£¼ì„¸ìš”:

```python
# â”€â”€ Set up rotating log to file + console â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
from logging.handlers import RotatingFileHandler

log_formatter = logging.Formatter("[%(asctime)s] %(levelname)s: %(message)s")

file_handler = RotatingFileHandler("stream_binance.log", maxBytes=10_000_000, backupCount=3)
file_handler.setFormatter(log_formatter)

console_handler = logging.StreamHandler()
console_handler.setFormatter(log_formatter)

logger = logging.getLogger("uvicorn.error")
logger.setLevel(logging.INFO)
logger.addHandler(file_handler)
logger.addHandler(console_handler)
```

ì´ë ‡ê²Œ í•˜ë©´:

* `stream_binance.log`ì— ë¡œê·¸ ì €ì¥ (10MB ì´ìƒì´ë©´ backup)
* ì½˜ì†” ì¶œë ¥ì—ë„ `[ì‹œê°„] ë¡œê·¸ë ˆë²¨: ë©”ì‹œì§€` í˜•ì‹ ìœ ì§€

---

## âœ… \[4] êµ¬ì¡° ì ê²€: `REPO_STRUCT.html` ë¶„ì„

### ğŸ“‚ REPO êµ¬ì¡° ìš”ì•½ (ì¶”ì •)

* `/data/binance/orderbook/temporary/` ì•„ë˜ì— ê°œë³„ `.zip` ì €ì¥
* `/data/binance/orderbook/`ì—ëŠ” ë‚ ì§œë³„ `.zip` ë³‘í•©ë³¸ ì €ì¥
* `templates/`, `get_binance_chart.conf`, `stream_binance.py` ë“± ì˜ ë°°ì¹˜ë¨

### ğŸ§  ê´€ì°°

* êµ¬ì¡°ìƒ íŒŒì¼ë“¤ì€ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ê³  ì •ë¦¬ë˜ê³  ìˆìŒ
* `.zip` ë³‘í•©ì´ ì˜ ì§„í–‰ë˜ì—ˆìŒì„ ë³´ì—¬ì¤Œ â†’ `merge_day_zips_to_single_jsonl()` ë™ì‘ ëŒ€ì²´ë¡œ ì„±ê³µì 

---

## ğŸ“Œ ê²°ë¡  ë° ê¶Œì¥ ì‘ì—… ëª©ë¡ ìš”ì•½

| ë¬¸ì œ                  | ê°œì„  ë°©í–¥                                     |
| ------------------- | ----------------------------------------- |
| `FileNotFoundError` | `.jsonl` ì¡´ì¬ í™•ì¸ í›„ ì‚­ì œí•˜ë„ë¡ ì•ˆì „ì„± ê°•í™”             |
| WebSocket ì—ëŸ¬        | `ping_timeout` ëª…ì‹œ, DNS ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ë¡œê·¸        |
| ë¡œê·¸ ë¯¸ê¸°ë¡              | `RotatingFileHandler`ë¡œ ë¡œê·¸íŒŒì¼ ê¸°ë¡ + íƒ€ì„ìŠ¤íƒ¬í”„ ì¶œë ¥ |
| êµ¬ì¡° ì ê²€               | `REPO_STRUCT.html` ê¸°ì¤€, ë³‘í•©/ì••ì¶• ì •ìƒ ì‘ë™ ì¤‘      |

---
